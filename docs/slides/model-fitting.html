<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.32">

  <meta name="author" content="Katie Schuler">
  <title>DataScience – Model Fitting</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-f563837468303362081e247dddd440d0.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
  <link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Model Fitting</h1>
  <p class="subtitle">Data Science for Studying Language and the Mind</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Katie Schuler 
</div>
</div>
</div>

</section>
<section id="announcements" class="slide level2">
<h2>Announcements</h2>
<ul>
<li class="fragment"><p>Final exam scheduled for December 19th at noon</p></li>
<li class="fragment"><p>If you have a conflict, please let us know by Demeber 6. We can proctor an earlier date.</p></li>
<li class="fragment"><p>Pset 03 solutions to be posted today!</p></li>
<li class="fragment"><p>Psets 04 and 05 pushed back by one week</p></li>
</ul>
</section>
<section id="you-are-here" class="slide level2 smaller">
<h2>You are <code>here</code></h2>
<div class="columns">
<div class="column" style="width:33%;">
<h5 id="data-science-with-r">Data science with R</h5>
<ul>
<li>R basics</li>
<li>Data visualization</li>
<li>Data wrangling</li>
</ul>
</div><div class="column" style="width:33%;">
<h5 id="stats-model-building">Stats &amp; Model building</h5>
<ul>
<li>Sampling distribution</li>
<li>Hypothesis testing</li>
<li>Model specification</li>
<li><code>Model fitting</code></li>
<li>Model accuracy</li>
<li>Model reliability</li>
</ul>
</div><div class="column" style="width:33%;">
<h5 id="more-advanced">More advanced</h5>
<ul>
<li>Classification</li>
</ul>
</div></div>
</section>
<section id="roadmap" class="slide level2 smaller">
<h2>Roadmap</h2>
<ul>
<li class="fragment">Fitting linear models in R</li>
<li class="fragment">Goodness of fit: quantifying our intuition</li>
<li class="fragment">Search problem: How do we find the best one?
<ol type="1">
<li class="fragment">Gradient descent - iterative optimization algorithm</li>
<li class="fragment">Ordinary least squares - analytical solution for linear regression</li>
</ol></li>
<li class="fragment">If time: another full example</li>
</ul>
</section>
<section id="fit-a-linear-model" class="slide level2 smaller">
<h2>Fit a linear model</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="model-fitting_files/figure-revealjs/unnamed-chunk-2-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<table class="caption-top">
<thead>
<tr class="header">
<th></th>
<th>model specification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>R syntax</td>
<td><code>rt ~ 1 + experience</code></td>
</tr>
<tr class="even">
<td>R syntax</td>
<td><code>rt ~ experience</code></td>
</tr>
<tr class="odd">
<td>Equation</td>
<td><span class="math inline">\(y=w_0+w_1x_1\)</span></td>
</tr>
</tbody>
</table>
</div><div class="column" style="width:40%;">
<div class="cell" data-fig-width="4" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class=""><p></p>
<div>
<svg width="384" height="480" viewbox="0.00 0.00 222.03 188.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none; display: block; margin: auto auto auto auto">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-184 218.03,-184 218.03,4 -4,4"></polygon>
<!-- a -->
<g id="node1" class="node">
<title>a</title>
<ellipse fill="none" stroke="black" cx="107.02" cy="-162" rx="88" ry="18"></ellipse>
<text text-anchor="middle" x="107.02" y="-157.8" font-family="Times,serif" font-size="14.00">Model specification</text>
</g>
<!-- b -->
<g id="node2" class="node">
<title>b</title>
<ellipse fill="none" stroke="black" cx="107.02" cy="-90" rx="107.03" ry="18"></ellipse>
<text text-anchor="middle" x="107.02" y="-85.8" font-family="Times,serif" font-size="14.00">Estimate free parameters</text>
</g>
<!-- a&#45;&gt;b -->
<g id="edge1" class="edge">
<title>a-&gt;b</title>
<path fill="none" stroke="black" d="M107.02,-143.7C107.02,-135.98 107.02,-126.71 107.02,-118.11"></path>
<polygon fill="black" stroke="black" points="110.52,-118.1 107.02,-108.1 103.52,-118.1 110.52,-118.1"></polygon>
</g>
<!-- c -->
<g id="node3" class="node">
<title>c</title>
<ellipse fill="none" stroke="black" cx="107.02" cy="-18" rx="60.25" ry="18"></ellipse>
<text text-anchor="middle" x="107.02" y="-13.8" font-family="Times,serif" font-size="14.00">Fitted model</text>
</g>
<!-- b&#45;&gt;c -->
<g id="edge2" class="edge">
<title>b-&gt;c</title>
<path fill="none" stroke="black" d="M107.02,-71.7C107.02,-63.98 107.02,-54.71 107.02,-46.11"></path>
<polygon fill="black" stroke="black" points="110.52,-46.1 107.02,-36.1 103.52,-46.1 110.52,-46.1"></polygon>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p><span class="math inline">\(y = 211.271 + -1.695x\)</span></p>
</div></div>
</section>
<section id="fit-a-linear-model-in-r" class="slide level2 smaller">
<h2>Fit a linear model in R</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="model-fitting_files/figure-revealjs/unnamed-chunk-4-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<table class="caption-top">
<thead>
<tr class="header">
<th></th>
<th>model specification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>R syntax</td>
<td><code>rt ~ 1 + experience</code></td>
</tr>
<tr class="even">
<td>R syntax</td>
<td><code>rt ~ experience</code></td>
</tr>
<tr class="odd">
<td>Equation</td>
<td><span class="math inline">\(y=w_0+w_1x_1\)</span></td>
</tr>
</tbody>
</table>
</div><div class="column" style="width:40%;">
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="fu">lm</span>(rt <span class="sc">~</span> experience, <span class="at">data =</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = rt ~ experience, data = data)

Coefficients:
(Intercept)   experience  
    211.271       -1.695  </code></pre>
</div>
</div>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a></a>    <span class="fu">specify</span>(rt <span class="sc">~</span> experience) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a></a>    <span class="fu">fit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  term       estimate
  &lt;chr&gt;         &lt;dbl&gt;
1 intercept    211.  
2 experience    -1.69</code></pre>
</div>
</div>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a><span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a></a>    <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a></a>    <span class="fu">fit</span>(rt <span class="sc">~</span> experience, <span class="at">data =</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>parsnip model object


Call:
stats::lm(formula = rt ~ experience, data = data)

Coefficients:
(Intercept)   experience  
    211.271       -1.695  </code></pre>
</div>
</div>
</div>
</div></div>
</section>
<section id="fitting-by-intuition" class="slide level2 smaller">
<h2>Fitting by intuition</h2>
<p>How would you draw a “best fit” line?</p>

<img data-src="model-fitting_files/figure-revealjs/unnamed-chunk-8-1.png" width="960" class="r-stretch"><ul>
<li class="fragment">Draw a straight line that goes through as many points as possible.</li>
</ul>
</section>
<section id="fitting-by-intuition-1" class="slide level2 smaller">
<h2>Fitting by intuition</h2>
<p>Which line fits best? How can you tell?</p>
<div class="cell quarto-layout-panel" data-layout-nrow="3" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img data-src="model-fitting_files/figure-revealjs/unnamed-chunk-9-1.png" width="960"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img data-src="model-fitting_files/figure-revealjs/unnamed-chunk-9-2.png" width="960"></p>
</div>
</div>
</div>
<ul>
<li class="fragment">B, because the model is closer to the data (closer to more of the points)</li>
</ul>
</section>
<section id="quantifying-goodness-of-fit" class="slide level2 smaller">
<h2>Quantifying “goodness” of fit</h2>
<p>We can measure how close the model is to the data</p>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img data-src="model-fitting_files/figure-revealjs/unnamed-chunk-10-1.png" width="960"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img data-src="model-fitting_files/figure-revealjs/unnamed-chunk-10-2.png" width="960"></p>
</div>
</div>
</div>
<ul>
<li class="fragment">We call these the “errors” or “residuals”. We want a single number that would represent goodness of fit.</li>
</ul>
</section>
<section id="sum-of-squared-error" class="slide level2 smaller">
<h2>Sum of squared error</h2>
<p>We can quantify our intutition and express goodness of fit with sum of squared error.</p>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img data-src="model-fitting_files/figure-revealjs/unnamed-chunk-11-1.png" width="960"></p>
</div>
<table class="table caption-top" data-quarto-postprocess="true" style="font-size: 16px; margin-left: auto; margin-right: auto;">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">experience</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rt</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">prediction</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">squared_error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">49</td>
<td style="text-align: right;">124</td>
<td style="text-align: right;">128.22414</td>
<td style="text-align: right;">4.2241379</td>
<td style="text-align: right;">17.8433413</td>
</tr>
<tr class="even">
<td style="text-align: right;">69</td>
<td style="text-align: right;">95</td>
<td style="text-align: right;">94.32759</td>
<td style="text-align: right;">-0.6724138</td>
<td style="text-align: right;">0.4521403</td>
</tr>
<tr class="odd">
<td style="text-align: right;">89</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">60.43103</td>
<td style="text-align: right;">-10.5689655</td>
<td style="text-align: right;">111.7030321</td>
</tr>
<tr class="even">
<td style="text-align: right;">99</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">43.48276</td>
<td style="text-align: right;">-1.5172414</td>
<td style="text-align: right;">2.3020214</td>
</tr>
<tr class="odd">
<td style="text-align: right;">109</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">26.53448</td>
<td style="text-align: right;">8.5344828</td>
<td style="text-align: right;">72.8373960</td>
</tr>
</tbody>
</table>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<pre><code>[1] 205.1379</code></pre>
</div>
</div>
</div>
<div class="fragment">
<p><span class="math inline">\(SSE=\sum_{i=i}^{n} (d_{i} - m_{i})^2 = 205.1379\)</span></p>
</div>
</section>
<section id="sum-of-squared-error-1" class="slide level2 smaller">
<h2>Sum of squared error</h2>
<p><span class="math inline">\(SSE=\sum_{i=i}^{n} (d_{i} - m_{i})^2\)</span></p>
<p>Given some data:</p>
<div class="fragment">
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top" data-quarto-postprocess="true" style="font-size: 18px; margin-left: auto; margin-right: auto;">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">experience</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rt</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">prediction</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">squared_error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">49</td>
<td style="text-align: right;">124</td>
<td style="text-align: right;">128.22414</td>
<td style="text-align: right;">4.2241379</td>
<td style="text-align: right;">17.8433413</td>
</tr>
<tr class="even">
<td style="text-align: right;">69</td>
<td style="text-align: right;">95</td>
<td style="text-align: right;">94.32759</td>
<td style="text-align: right;">-0.6724138</td>
<td style="text-align: right;">0.4521403</td>
</tr>
<tr class="odd">
<td style="text-align: right;">89</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">60.43103</td>
<td style="text-align: right;">-10.5689655</td>
<td style="text-align: right;">111.7030321</td>
</tr>
<tr class="even">
<td style="text-align: right;">99</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">43.48276</td>
<td style="text-align: right;">-1.5172414</td>
<td style="text-align: right;">2.3020214</td>
</tr>
<tr class="odd">
<td style="text-align: right;">109</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">26.53448</td>
<td style="text-align: right;">8.5344828</td>
<td style="text-align: right;">72.8373960</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="fragment">
<p>Compute the sum of squared error:</p>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a>  data <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a></a>    <span class="fu">mutate</span>(<span class="at">prediction =</span> <span class="fu">predict</span>(model, data)) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a></a>    <span class="fu">mutate</span>(<span class="at">error =</span> prediction <span class="sc">-</span> rt) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a></a>    <span class="fu">mutate</span>(<span class="at">squared_error =</span> error<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a></a>    <span class="fu">with</span>(<span class="fu">sum</span>(squared_error))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 205.1379</code></pre>
</div>
</div>
<p><span class="math inline">\(SSE=\sum_{i=i}^{n} (d_{i} - m_{i})^2 = 205.1379\)</span></p>
</div>
</section>
<section id="problem-1-check-model-parameters" class="slide level2 smaller">
<h2>Problem 1: check model parameters</h2>
<ul>
<li class="fragment">The <code>predict()</code> way uses a fitted model, which already has the best fitting free parameters.</li>
<li class="fragment">We need a way to check different <em>potential</em> model fits to see which one is best.</li>
<li class="fragment">Let’s write a function!</li>
</ul>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a>SSE <span class="ot">&lt;-</span> <span class="cf">function</span>(data, par) {</span>
<span id="cb10-2"><a></a>    data <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a></a>        <span class="fu">mutate</span>(<span class="at">prediction =</span> par[<span class="dv">1</span>] <span class="sc">+</span> par[<span class="dv">2</span>] <span class="sc">*</span> experience) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a></a>        <span class="fu">mutate</span>(<span class="at">error =</span> prediction <span class="sc">-</span> rt) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a></a>        <span class="fu">mutate</span>(<span class="at">squared_error =</span> error<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a></a>        <span class="fu">with</span>(<span class="fu">sum</span>(squared_error))</span>
<span id="cb10-7"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<p>Now we can check any model parameters.</p>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a><span class="fu">SSE</span>(data, <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 31791</code></pre>
</div>
</div>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a><span class="fu">SSE</span>(data, <span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 222783</code></pre>
</div>
</div>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a><span class="fu">SSE</span>(data, <span class="fu">c</span>(<span class="fl">211.271</span>,<span class="sc">-</span><span class="fl">1.695</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 205.139</code></pre>
</div>
</div>
</div>
</section>
<section id="problem-2-yikes" class="slide level2 smaller">
<h2>Problem 2: yikes</h2>
<ul>
<li class="fragment">That’s a lot of parameters to test! (<code>Inf</code>?)</li>
<li class="fragment">Also, how do we know when to stop?</li>
</ul>
</section>
<section id="simplests-possible-case-is-hard" class="slide level2 smaller">
<h2>Simplests possible case is hard</h2>
<p>Check every para</p>

<img data-src="model-fitting_files/figure-revealjs/unnamed-chunk-18-1.png" width="960" class="r-stretch"></section>
<section>
<section id="iterative-optimization" class="title-slide slide level1 center">
<h1>Iterative optimization</h1>

</section>
<section id="search-problem" class="slide level2">
<h2>Search problem</h2>
<ul>
<li class="fragment">We have a parameter space, a cost function, and our job is to search through the space to find the point that minimizes the cost function.</li>
<li class="fragment">Since we are using the cost function of squared error, we can think of our job as trying to find the minimum point on an <em>error surface</em></li>
</ul>
</section>
<section id="error-surface" class="slide level2 smaller">
<h2>Error surface</h2>
<p>If there is only one parameter, the error surface of a function is a curvy line; if there are two parameters, it’s a bumpy sheet; etc.</p>

<img data-src="../assests/images/error-surface.png" class="r-stretch"></section>
<section id="iterative-optimization-1" class="slide level2">
<h2>Iterative optimization</h2>
<p>To search through a parameter space, we can use local, iterative optimization.</p>
<ul>
<li class="fragment">Start at some point in space (<em>initial seed</em>)</li>
<li class="fragment">look at the error surface in a small neighborhood around that point</li>
<li class="fragment">move in some directoion in an attempt to reduce the error (cost)</li>
<li class="fragment">and repeat until improvements are sufficiently small</li>
</ul>
</section>
<section id="gradient-descent" class="slide level2">
<h2>Gradient descent</h2>
<p>There are many iterative optimazation algorithms out there that vary in how they execute these steps. One simple example is <strong>gradient descent</strong></p>

<img data-src="../assests/images/grad-desc-intuition.jpeg" class="r-stretch"></section>
<section id="gradient-descent-1" class="slide level2">
<h2>Gradient descent</h2>

<img data-src="../assests/images/gradient-descent.png" class="r-stretch"></section>
<section id="gradient-descent-in-r" class="slide level2 smaller">
<h2>Gradient descent in R</h2>
<p>Define our cost function (step 1):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a>SSE <span class="ot">&lt;-</span> <span class="cf">function</span>(data, par) {</span>
<span id="cb17-2"><a></a>  data <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a></a>    <span class="fu">mutate</span>(<span class="at">prediction =</span> par[<span class="dv">1</span>] <span class="sc">+</span> par[<span class="dv">2</span>]<span class="sc">*</span> experience) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a></a>    <span class="fu">mutate</span>(<span class="at">error =</span> prediction <span class="sc">-</span> rt) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a></a>    <span class="fu">mutate</span>(<span class="at">squared_error =</span> error<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a></a>    <span class="fu">with</span>(<span class="fu">sum</span>(squared_error))</span>
<span id="cb17-7"><a></a>}</span>
<span id="cb17-8"><a></a></span>
<span id="cb17-9"><a></a><span class="fu">SSE</span>(<span class="at">data =</span> data, <span class="at">par =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 31791</code></pre>
</div>
</div>
</section>
<section id="gradient-descent-in-r-1" class="slide level2 smaller">
<h2>Gradient descent in R</h2>
<p>Impliment gradient descent algorithm with <code>optimg</code> (step 2):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a><span class="fu">optimg</span>(</span>
<span id="cb19-2"><a></a>    <span class="at">data =</span> data,  <span class="co"># our data</span></span>
<span id="cb19-3"><a></a>    <span class="at">par =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="co"># our starting parameters</span></span>
<span id="cb19-4"><a></a>    <span class="at">fn =</span> SSE,     <span class="co"># our cost function</span></span>
<span id="cb19-5"><a></a>    <span class="at">method =</span> <span class="st">"STGD"</span>) <span class="co"># our iterative optimization algorithm </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$par
[1] 211.26155  -1.69473

$value
[1] 205.138

$counts
[1] 12

$convergence
[1] 0</code></pre>
</div>
</div>
</section>
<section id="gradient-descent-v.-lm" class="slide level2">
<h2>Gradient descent v. <code>lm()</code></h2>
<p>We can compare <code>optimg</code>’s estimates to that of <code>lm()</code> to see that they are <em>nearly</em> identical:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a><span class="fu">lm</span>(rt <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> experience, <span class="at">data =</span> data) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = rt ~ 1 + experience, data = data)

Coefficients:
(Intercept)   experience  
    211.271       -1.695  </code></pre>
</div>
</div>
</section>
<section id="local-minumim-problem" class="slide level2 smaller">
<h2>Local minumim problem</h2>
<p>A potential problem with iterative optimization algorithms is the risk of finding a <em>local minimum</em>.</p>

<img data-src="../assests/images/gradient-descent.png" class="r-stretch"></section>
<section id="local-minimum-is-only-relevant-for-nonlinear-models" class="slide level2 smaller">
<h2>Local minimum is only relevant for nonlinear models</h2>
<p>Only nonlinear models have this potential problem. Even it higher dimensions.</p>

<img data-src="../assests/images/local-v-global-min.png" class="r-stretch"></section>
<section id="linear-models-do-not-have-this-problem" class="slide level2 smaller">
<h2>Linear models do not have this problem</h2>
<p>For all linear models, we can think of the error surface is being shaped like a bowl, so there is <em>no risk</em> of a local minimum.</p>

<img data-src="../assests/images/grad-desct-linearmodel.png" class="r-stretch"></section></section>
<section>
<section id="ordinary-least-squares-ols" class="title-slide slide level1 center">
<h1>Ordinary least-squares (OLS)</h1>

</section>
<section id="ordinary-least-squares-solution" class="slide level2 smaller">
<h2>Ordinary least squares solution</h2>
<p>Another way we can find the best fitting free parameters for linear (or linearizable nonlinear) models is to use the Ordinary Least-Squares (OLS) estimate.</p>
<ul>
<li class="fragment">In OLS, the best-fitting free parameters are found by solving a system of equations (using matrix operations/linear algebra) which leads to a closed-form solution.<br>
</li>
<li class="fragment">This means that OLS provides <em>exact values</em> of the best-fitting parameters in one step (as long as a few necessary conditions are met).</li>
</ul>
</section>
<section id="ols-v.-iterative-optimization" class="slide level2 smaller">
<h2>OLS v. iterative optimization</h2>
<ul>
<li class="fragment">We can contrast this with iterative optimization algorithms (like gradient descent) which gradually adjust the model parameters over multiple iterations to minimize the error, often requiring many steps to converge on <em>approximate values</em> of the best-fitting parameters.</li>
</ul>
</section>
<section id="ols-intuition" class="slide level2">
<h2>OLS intuition</h2>
<p>In OLS, the goal is to model the relationship between input variables and the output variable (<span class="math inline">\(y\)</span>) as a linear combination. We express this very generally in our favorite equation, where the output (<span class="math inline">\(y\)</span>) is a weighted sum of inputs (<span class="math inline">\(x_i\)</span>).</p>
<ul>
<li class="fragment"><span class="math inline">\(y=\sum_{i=1}^{n}w_ix_i\)</span></li>
</ul>
</section>
<section id="ols-intuition-1" class="slide level2 smaller">
<h2>OLS intuition</h2>
<p>Recall that this general expression has many 🥸 aliases. That is, the <strong>linear model equation</strong> can be expressed in many ways, but <em>they are all this same thing</em>:</p>
<ol type="1">
<li class="fragment">in <strong>high school algebra</strong>: <span class="math inline">\(y=ax+b\)</span>.</li>
<li class="fragment">in <strong>machine learning</strong>: <span class="math inline">\(y = w_0 + w_1x_1 + w_2x_2 + ... + w_nx_n\)</span></li>
<li class="fragment">in <strong>statistics</strong>: <span class="math inline">\(y = β_0 + β_1x_1 + β_2x_2 + ... + β_nx_n + ε\)</span></li>
<li class="fragment">in <strong>matrix</strong> notation: <span class="math inline">\(y = Xw + ε\)</span></li>
</ol>
</section>
<section id="ols-on-example-dataset-15" class="slide level2 smaller">
<h2>OLS on example dataset 1/5</h2>
<p>The matrix notation is what allows us to appreciate that we can solve for the best fitting free parameters with linear algebra.</p>
</section>
<section id="ols-on-example-dataset-25" class="slide level2 smaller">
<h2>OLS on example dataset 2/5</h2>
<p>We can express in matrix notation:</p>
<p><span class="math display">\[
\begin{aligned}
    \mathbf{y} = \mathbf{X} \mathbf{w} + \mathbf{\epsilon}
\end{aligned}
\]</span></p>
<p>Where:</p>
<ul>
<li class="fragment"><span class="math inline">\(\mathbf{y}\)</span> is the output vector (<code>rt</code>).</li>
<li class="fragment"><span class="math inline">\(\mathbf{X}\)</span> is the input matrix (<code>experience</code> with an intercept).</li>
<li class="fragment"><span class="math inline">\(\mathbf{w}\)</span> is the weight vector (parameter estimates including the intercept).</li>
<li class="fragment"><span class="math inline">\(\boldsymbol{\epsilon}\)</span> is the vector of errors (residuals).</li>
</ul>
</section>
<section id="ols-on-example-dataset-25-1" class="slide level2">
<h2>OLS on example dataset 2/5</h2>
<p>Because our data set is small, we can expand these to help you picture this visually a little better:</p>
<ol type="1">
<li class="fragment"><strong>Input Matrix</strong> <span class="math inline">\(\mathbf{X}\)</span> (intercept and <code>experience</code>):</li>
</ol>
<p><span class="math display">\[
\begin{aligned}
   \mathbf{X} = \begin{bmatrix}
   1 &amp; 49 \\
   1 &amp; 69 \\
   1 &amp; 89 \\
   1 &amp; 99 \\
   1 &amp; 109
   \end{bmatrix}
\end{aligned}
\]</span></p>
</section>
<section id="ols-on-example-dataset-35" class="slide level2">
<h2>OLS on example dataset 3/5</h2>
<ol start="2" type="1">
<li class="fragment"><strong>Output Vector</strong>, <span class="math inline">\(\mathbf{y}\)</span> (<code>rt</code>):</li>
</ol>
<p><span class="math display">\[
\begin{aligned}
   \mathbf{y} = \begin{bmatrix}
   124 \\
   95 \\
   71 \\
   45 \\
   18
   \end{bmatrix}
\end{aligned}
\]</span></p>
</section>
<section id="ols-on-example-dataset-45" class="slide level2">
<h2>OLS on example dataset 4/5</h2>
<ol start="3" type="1">
<li class="fragment"><strong>Weight Vector</strong>, <span class="math inline">\(\mathbf{w}\)</span> (Unknown coefficients including intercept):</li>
</ol>
<p><span class="math display">\[
\begin{aligned}
   \mathbf{w} = \begin{bmatrix}
   w_1 \\  % Intercept
   w_2   % Weight for experience
   \end{bmatrix}
\end{aligned}
\]</span></p>
</section>
<section id="ols-on-example-datset-55" class="slide level2">
<h2>OLS on example datset 5/5</h2>
<p>Putting it all together, the linear model equation becomes, where there is a vector of errors (residuals), <span class="math inline">\(\mathbf{\epsilon}\)</span>.</p>
<p><span class="math display">\[
\begin{aligned}
    \begin{bmatrix}
    124 \\
    95 \\
    71 \\
    45 \\
    18
    \end{bmatrix}
    =
    \begin{bmatrix}
    1 &amp; 49 \\
    1 &amp; 69 \\
    1 &amp; 89 \\
    1 &amp; 99 \\
    1 &amp; 109
    \end{bmatrix}
    \begin{bmatrix}
    w_1 \\
    w_2
    \end{bmatrix}
    +
    \begin{bmatrix}
        \epsilon_1 \\
        \epsilon_2 \\
        \epsilon_3 \\
        \epsilon_4 \\
        \epsilon_5 \\
    \end{bmatrix}
\end{aligned}
\]</span></p>
</section>
<section id="ols-with-r-example-14" class="slide level2">
<h2>OLS with R example 1/4</h2>
<p>At this stage, we can take the mathematicians’ word for it that this provides an <em>exact</em> solution to the best fitting parameter estimates.</p>
<p>We can demonstrate this with code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a> ols_matrix_way <span class="ot">&lt;-</span> <span class="cf">function</span>(X, Y){</span>
<span id="cb23-2"><a></a>  <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X) <span class="sc">%*%</span> <span class="fu">t</span>(X) <span class="sc">%*%</span> Y</span>
<span id="cb23-3"><a></a> }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ols-with-r-example-24" class="slide level2">
<h2>OLS with R example 2/4</h2>
<p>We need to construct X and Y (must be matrices):</p>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a></a>(response_matrix <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">select</span>(rt) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>())</span>
<span id="cb24-2"><a></a>(explanatory_matrix <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">int =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(int, experience) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<pre><code>      rt
[1,] 124
[2,]  95
[3,]  71
[4,]  45
[5,]  18</code></pre>
</div>
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<pre><code>     int experience
[1,]   1         49
[2,]   1         69
[3,]   1         89
[4,]   1         99
[5,]   1        109</code></pre>
</div>
</div>
</div>
</section>
<section id="ols-with-r-example-34" class="slide level2">
<h2>OLS with R example 3/4</h2>
<p>Then we can use our function to generate the OLS solution:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a><span class="fu">ols_matrix_way</span>(explanatory_matrix, response_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   rt
int        211.270690
experience  -1.694828</code></pre>
</div>
</div>
</section>
<section id="ols-with-r-example-44" class="slide level2">
<h2>OLS with R example 4/4</h2>
<p>Which is <strong>exactly the same</strong> as that returned by <code>lm()</code> (because lm is doing this!)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a></a><span class="fu">lm</span>(rt <span class="sc">~</span> experience, <span class="at">data =</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = rt ~ experience, data = data)

Coefficients:
(Intercept)   experience  
    211.271       -1.695  </code></pre>
</div>
</div>
</section>
<section id="constraints-on-ols" class="slide level2">
<h2>Constraints on OLS</h2>
<ul>
<li class="fragment">Importantly, if there are more regressors than data points, then there is no OLS solution. The intuition for the underlying math is that if there are more weights than data points, there are infinatly many solutions, all of which acheive zero error.</li>
</ul>
</section>
<section id="constraints-on-ols-1" class="slide level2">
<h2>Constraints on OLS</h2>
<p>We can fit if there are fewer inputs than datapoints</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a></a>data2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb31-2"><a></a>    <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">7</span>), </span>
<span id="cb31-3"><a></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), </span>
<span id="cb31-4"><a></a>    <span class="at">z =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>), </span>
<span id="cb31-5"><a></a>    <span class="at">a =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>)</span>
<span id="cb31-6"><a></a>)</span>
<span id="cb31-7"><a></a></span>
<span id="cb31-8"><a></a>(model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> x, <span class="at">data =</span> data2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ 1 + x, data = data2)

Coefficients:
(Intercept)            x  
    -0.3333       2.5000  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a></a>(model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> x <span class="sc">+</span> z <span class="sc">+</span> a, <span class="at">data =</span> data2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ 1 + x + z + a, data = data2)

Coefficients:
(Intercept)            x            z            a  
    -0.3333       2.5000           NA           NA  </code></pre>
</div>
</div>
</section>
<section id="constraints-on-ols-2" class="slide level2">
<h2>Constraints on OLS</h2>
<p>But not if there are more inputs than datapoints in our model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a>(model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> x <span class="sc">+</span> z <span class="sc">+</span> a, <span class="at">data =</span> data2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ 1 + x + z + a, data = data2)

Coefficients:
(Intercept)            x            z            a  
    -0.3333       2.5000           NA           NA  </code></pre>
</div>
</div>
<p><code>lm()</code> is smart and fits the reduced model it <em>can</em> fit. If we try to solve this the matrix way via our homegrown function, we get an error.</p>
</section>
<section id="lets-try-it" class="slide level2">
<h2>Let’s try it!!</h2>
</section>
<section id="extra-slides" class="slide level2">
<h2>Extra slides</h2>
<p>And solve with linear algebra: <span class="math inline">\(w = (X^TX)^{-1}X^TY\)</span></p>
<!-- \[
\begin{bmatrix}
124\\
95\\
71\\
45\\
18\\
\end{bmatrix}
=
\begin{bmatrix}
1 & 49\\
1 & 69\\
1 & 79\\
1 & 89\\
1 & 99\\
1 & 109\\
\end{bmatrix}
\times
\begin{bmatrix}
w_0\\
w_1\\
\end{bmatrix} 
\] -->
</section>
<section id="ordinary-least-squares-solution-in-r" class="slide level2 smaller">
<h2>Ordinary least squares solution in R</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a></a> ols_matrix_way <span class="ot">&lt;-</span> <span class="cf">function</span>(X, Y){</span>
<span id="cb37-2"><a></a>  <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> X) <span class="sc">%*%</span> <span class="fu">t</span>(X) <span class="sc">%*%</span> Y</span>
<span id="cb37-3"><a></a> }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>We need to construct X and Y (must be matrices):</p>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a></a>(response_matrix <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">select</span>(rt) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>())</span>
<span id="cb38-2"><a></a>(explanatory_matrix <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">int =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(int, experience) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<pre><code>      rt
[1,] 124
[2,]  95
[3,]  71
[4,]  45
[5,]  18</code></pre>
</div>
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<pre><code>     int experience
[1,]   1         49
[2,]   1         69
[3,]   1         89
[4,]   1         99
[5,]   1        109</code></pre>
</div>
</div>
</div>
</div>
<div class="fragment">
<p>Then we can use our function to generate the OLS solution:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a></a><span class="fu">ols_matrix_way</span>(explanatory_matrix, response_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   rt
int        211.270690
experience  -1.694828</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a></a><span class="fu">lm</span>(rt <span class="sc">~</span> experience, <span class="at">data =</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = rt ~ experience, data = data)

Coefficients:
(Intercept)   experience  
    211.271       -1.695  </code></pre>
</div>
</div>
<!-- 

## Linear model functional form

| field | linear model eq |
| --- | --------- |
| `h.s. algebra` | $y=ax+b$ |
| `machine learning` | $y = w_0 + w_1x_1 + w_2x_2 + ... + w_nx_n$ |
| `statistics` | $y = β_0 + β_1x_1 + β_2x_2 + ... + β_nx_n + ε$ |
| `matrix` | $y = Xβ + ε$ |


## Fitting a linear model {.smaller}

:::: {.columns}

::: {.column width="33%"}





:::

::: {.column width="67%"}


::: {.cell}

:::



::: {.cell}

```{.r .cell-code}
ggplot(data, aes(x = x, y = y)) +
    geom_point(size = 4, color = "darkred") +
    geom_smooth(method = "lm", formula = 'y ~ x', se = FALSE) 
```

::: {.cell-output-display}
![](model-fitting_files/figure-revealjs/unnamed-chunk-33-1.png){width=960}
:::
:::


:::



::::

## Fitting by intuition {.smaller}

How would you draw a "best fit" line?  



::: {.cell}
::: {.cell-output-display}
![](model-fitting_files/figure-revealjs/unnamed-chunk-34-1.png){width=960}
:::
:::


## Fitting by intuition {.smaller}

Which line fits best?  How can you tell? 


::: {.cell layout-nrow="3" layout-ncol="2"}
::: {.cell-output-display}
![](model-fitting_files/figure-revealjs/unnamed-chunk-35-1.png){width=960}
:::

::: {.cell-output-display}
![](model-fitting_files/figure-revealjs/unnamed-chunk-35-2.png){width=960}
:::
:::



## Quantifying "goodness" of fit  {.smaller}

We can measure how close the model is to the data


::: {.cell}

:::






::: {.cell layout-ncol="2"}
::: {.cell-output-display}
![](model-fitting_files/figure-revealjs/unnamed-chunk-37-1.png){width=960}
:::

::: {.cell-output-display}
![](model-fitting_files/figure-revealjs/unnamed-chunk-37-2.png){width=960}
:::
:::


. . . 

`residuals`

## {.smaller} 


::: {.cell layout-nrow="2" layout-ncol="2"}
::: {.cell-output-display}
![](model-fitting_files/figure-revealjs/unnamed-chunk-38-1.png){width=960}
:::

::: {.cell-output-display}
![](model-fitting_files/figure-revealjs/unnamed-chunk-38-2.png){width=960}
:::

::: {.cell-output-display}


|  x|   y| pred|  err| sq_err|
|--:|---:|----:|----:|------:|
|  1| 1.2|  1.3| -0.1|   0.01|
|  2| 2.5|  2.0|  0.5|   0.25|
|  3| 2.3|  2.7| -0.4|   0.16|
|  4| 3.1|  3.4| -0.3|   0.09|
|  5| 4.4|  4.1|  0.3|   0.09|


:::

::: {.cell-output-display}


|  x|   y| pred|   err| sq_err|
|--:|---:|----:|-----:|------:|
|  1| 1.2| 1.58| -0.38| 0.1444|
|  2| 2.5| 2.62| -0.12| 0.0144|
|  3| 2.3| 3.66| -1.36| 1.8496|
|  4| 3.1| 4.70| -1.60| 2.5600|
|  5| 4.4| 5.74| -1.34| 1.7956|


:::
:::


## But there are infinite possibilities

We can't test all `Inf` of the possible free parameters

$y=b_0+b_1x_1$

:::: {.columns}

::: {.column width="50%"}

#### Free parameters to test

![](../include/figures/error-surf-1.png)

:::

::: {.column width="50%"}

#### Level = SSE

![](../include/figures/error-surf-2.png)

:::

::::


## Error surface 

![](../include/figures/error-surface.png)

## Gradient descent, intuition

![](../include/figures/grad-desc-intuition.jpeg)

## Gradient descent 

![](../include/figures/gradient-descent.png)

## Gradient descent linear model 

![](../include/figures/error-surface-linear.png)

Linear models are convex functions: one minimum

## Ordinary least squares

Linear models have a solution: we can solve for the values with linear algebra. 

:::: {.columns}

::: {.column width="50%"}

#### $y = ax + b$

$1.2 = a1 + b$

$2.5 = a2 + b$

::: 

::: {.column width="50%"}


::: {.cell}

```{.r .cell-code}
lm(y ~ 1 + x, data)
```

::: {.cell-output .cell-output-stdout}

```

Call:
lm(formula = y ~ 1 + x, data = data)

Coefficients:
(Intercept)            x  
        0.6          0.7  
```


:::
:::



::: {.cell}

```{.r .cell-code}
data %>%
    specify(y ~ 1 + x) %>%
    fit()
```

::: {.cell-output .cell-output-stdout}

```
# A tibble: 2 × 2
  term      estimate
  <chr>        <dbl>
1 intercept    0.600
2 x            0.7  
```


:::
:::


:::

::::

`ordinary least squares`











 -->


</div>
</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p><a href="../index.html">https://kschuler.github.io/datasci-langmind/</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>